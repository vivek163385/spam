<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Our Love Journey ‚ù§Ô∏è</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
@media (max-width: 700px){

.card{
width:90%;
padding:26px;
border-radius:28px;
}

.envelope{
width:92%;
height:180px;
}

.letter{
max-height:220px;
font-size:1em;
}

.board .cell{
height:70px;
font-size:2em;
}

.mosaic{
grid-template-columns:repeat(3,1fr);
}

#finalLove{
font-size:2.2em;
}

button{
font-size:1em;
}

}
body{
touch-action:manipulation;
-webkit-tap-highlight-color: transparent;
}


#mapTitle{
position:absolute;
top:20px;
left:50%;
transform:translateX(-50%);
padding:14px 28px;
font-size:1.5em;
font-weight:600;
color:#ff4e8b;
background:rgba(255,255,255,.8);
backdrop-filter:blur(18px);
border-radius:30px;
box-shadow:0 10px 30px rgba(0,0,0,.25);
z-index:10;
}

*{box-sizing:border-box}
html,body{margin:0;height:100%;overflow:hidden;font-family:Segoe UI,Inter}

#bg{position:fixed;inset:0;z-index:-2}
.bgTile{
position:absolute;width:230px;height:230px;
background-size:cover;background-position:center;
border-radius:22px;
filter:blur(12px) brightness(.55)
}

/* SPA */
#app{
display:flex;
height:100vh;
transition:.9s cubic-bezier(.4,1.3,.6,1);
}
.screen{
min-width:100vw;
display:flex;
align-items:center;
justify-content:center;
padding:30px;
}

.card{
background:rgba(255,255,255,.78);
backdrop-filter:blur(26px);
border-radius:40px;
padding:42px;
width:460px;
text-align:center;
box-shadow:0 40px 90px rgba(0,0,0,.35);
}

input{
width:100%;
padding:14px;
border-radius:16px;
border:2px solid #ffd1dc;
font-size:1em;
}

button{
width:100%;
margin-top:14px;
padding:14px;
border:none;
border-radius:30px;
background:linear-gradient(135deg,#ff758c,#ff7eb3);
color:white;
cursor:pointer;
}

#map{width:100%;height:100%}

/* Games */
.board{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:20px}
.cell{
background:white;border-radius:18px;height:90px;
display:flex;align-items:center;justify-content:center;
font-size:2.5em;color:#ff4e8b;cursor:pointer;
}

.mosaic{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-top:20px}
.tile{
aspect-ratio:1/1;border-radius:18px;
background:linear-gradient(135deg,#ff9bb8,#ff6fa5);
cursor:pointer;overflow:hidden
}
.tile img{width:100%;height:100%;object-fit:cover;display:none}
.tile.revealed img{display:block}

/* Envelope */
.envelope{
width:400px;height:200px;
background:white;border-radius:18px;
margin:auto;box-shadow:0 20px 50px rgba(0,0,0,.25);
cursor:pointer;overflow:hidden;position:relative;
transition:transform .6s ease;
box-shadow:
0 20px 50px rgba(0,0,0,.25),
0 0 25px rgba(255,120,170,.6);
transition:transform .6s ease, box-shadow .6s ease;
}

.envelope.open{
transform:scale(1.05);
transform:scale(1.05);
box-shadow:
0 25px 70px rgba(0,0,0,.35),
0 0 45px rgba(255,120,170,.9);
}

.envelope .flap{
height:55%;
background:linear-gradient(#ffd1dc,#ffb3c6);
border-radius:0 0 120px 120px;
transition:.8s;
transform-origin:top;
}
.envelope.open .flap{transform:rotateX(180deg)}

/* ‚ù§Ô∏è PATCHED LETTER ONLY */
.letter{
position:absolute;
bottom:-120%;
left:2%;
width:96%;
max-height:60vh;
background:white;
border-radius:16px;
padding:22px;
color:#ff4e8b;
font-family:cursive;
transition:.9s;
overflow-y:auto;
line-height:1.6;
background:
  linear-gradient(rgba(255,255,255,.94), rgba(255,255,255,.94)),
  url("paper-texture.png");
background-size:cover;
background-blend-mode:overlay;
}

.letter::before{
content:"";
position:absolute;
inset:-25px;
background:radial-gradient(circle,
rgba(255,120,170,.55),
transparent 70%);
filter:blur(35px);
z-index:-1;
animation:letterGlow 2.5s ease-in-out infinite alternate;
}

@keyframes letterGlow{
from{opacity:.4; transform:scale(.95);}
to{opacity:1; transform:scale(1.08);}
}
 
.envelope.open .letter{bottom:15%}

/* Valentine */
#valBox{position:relative;height:200px;margin-top:20px}
#yesBtn{position:absolute;bottom:0;left:0;right:0;margin:auto}
#noBtn{position:fixed}

/* Final love */
#finalLove{
font-size:3.3em;
font-weight:800;
color:#ff4e8b;
text-align:center;
animation:pulseText 1.3s ease infinite alternate;
}


@keyframes pulseText{to{transform:scale(1.08)}}

canvas{position:fixed;top:0;left:0;pointer-events:none}

.heart{
position:fixed;bottom:-40px;font-size:24px;
animation:floatUp 6s linear forwards;pointer-events:none;
}
@keyframes floatUp{
to{transform:translateY(-110vh);opacity:0}
}

#photoModal{
display:none;position:fixed;inset:0;
background:rgba(0,0,0,.75);
align-items:center;justify-content:center;z-index:20;
}
#photoModal img{
max-width:80%;max-height:80%;
border-radius:20px;
box-shadow:0 0 40px rgba(255,120,170,.8)
}

.envelope.open .letter{
bottom:15%;
animation:slideLetter .9s ease-out;
}

@keyframes slideLetter{
from{transform:translateY(30px);opacity:0;}
to{transform:translateY(0);opacity:1;}
}

#letterTitle{
transition:opacity .8s ease, transform .8s ease;
}

#letterTitle.fadeOut{
opacity:0;
transform:translateY(-15px);
}

.screen .card{
animation:popIn .6s ease;
}
@keyframes popIn{
from{transform:scale(.85);opacity:0;}
to{transform:scale(1);opacity:1;}
}

#progressBar{
position:fixed;
top:16px;
left:50%;
transform:translateX(-50%);
display:flex;
gap:10px;
z-index:50;
}

.heartStep{
font-size:26px;
opacity:.35;
transition:.4s ease;
}

.heartStep.active{
opacity:1;
filter:drop-shadow(0 0 8px #ff6fa5);
transform:scale(1.15);
}

.card.compact{
padding:28px;
width:650px;
transition:width .9s ease, padding .9s ease;
}

.letter{
background:
linear-gradient(rgba(255,255,255,.96), rgba(255,255,255,.96)),
repeating-linear-gradient(
  0deg,
  rgba(0,0,0,.015),
  rgba(0,0,0,.015) 1px,
  transparent 1px,
  transparent 3px
);
}
.letter{
box-shadow:
inset 0 0 12px rgba(0,0,0,.08),
0 12px 35px rgba(0,0,0,.25);
}

.letter{
animation:candleGlow 3.5s ease-in-out infinite;
}

@keyframes candleGlow{
0%{
  box-shadow:
  inset 0 0 12px rgba(0,0,0,.08),
  0 12px 35px rgba(0,0,0,.25),
  0 0 25px rgba(255,180,120,.35);
}
40%{
  box-shadow:
  inset 0 0 10px rgba(0,0,0,.05),
  0 14px 40px rgba(0,0,0,.3),
  0 0 38px rgba(255,160,110,.5);
}
70%{
  box-shadow:
  inset 0 0 14px rgba(0,0,0,.1),
  0 10px 30px rgba(0,0,0,.22),
  0 0 20px rgba(255,190,130,.3);
}
100%{
  box-shadow:
  inset 0 0 12px rgba(0,0,0,.08),
  0 12px 35px rgba(0,0,0,.25),
  0 0 25px rgba(255,180,120,.35);
}
}

.letter{
background:
  linear-gradient(0deg, rgba(255,255,255,.94), rgba(255,255,255,.94)),
  url("https://www.transparenttextures.com/patterns/paper-fibers.png");
background-blend-mode:soft-light;
}
.letter{
border:1px solid rgba(255,180,130,.35);
}
.letter{
animation:
candleGlow 3.5s ease-in-out infinite,
breathLight 6s ease-in-out infinite;
}

@keyframes breathLight{
0%{filter:brightness(1)}
50%{filter:brightness(1.06)}
100%{filter:brightness(1)}
}

.floatingHeart{
position:fixed;
bottom:-60px;
font-size:18px;
opacity:.6;
pointer-events:none;
animation:heartFloat linear forwards;
filter:drop-shadow(0 0 6px rgba(255,120,170,.6));
}

@keyframes heartFloat{
0%{
transform:translateY(0) scale(.8);
opacity:.3;
}
30%{opacity:.7}
100%{
transform:translateY(-120vh) scale(1.2);
opacity:0;
}
}

transform:translate(
calc(-40px + 80px * var(--drift)),
-120vh
);


.plane{font-size:26px}

</style>
</head>

<body>



<audio id="heartSound">
  <source src="heartbeat.mp3" type="audio/mpeg">
</audio>

<audio id="hurraySound">
  <source src="hurray.mp3" type="audio/mpeg">
</audio>

<audio id="bgMusic" loop>
  <source src="romantic.mp3" type="audio/mpeg">
</audio>


<div id="progressBar"></div>

<div id="bg"></div>
<canvas id="fx"></canvas>

<div id="photoModal" onclick="closePhoto()">
<img id="modalImg">
</div>

<div id="app">

<!-- QUESTIONS -->
<div class="screen"><div class="card">
<h1>Ready to dive in? <br>prove your identity first! üîê</h1>
<input id="q1" placeholder="Enter my phone number">
<button onclick="check1()">Submit</button>
</div></div>

<div class="screen"><div class="card">
<h1>where do we both enjoy the best üçï?</h1>
<input id="q2">
<button onclick="check2()">Submit</button>
</div></div>

<div class="screen"><div class="card">
<h1>Tea or Coffee? and How do i take it??</h1>
<input id="q3">
<button onclick="check3()">Submit</button>
</div></div>

<!-- MAP TITLE -->
<div class="screen" onclick="next()">
<div class="card">
<h1>Every place became so special with you ‚ù§Ô∏è</h1>
<p>Each journey was more beautiful because of us üåç‚ú®</p>
</div>
</div>

<!-- MAP -->
<div class="screen"><div id="map"></div></div>

<!-- TIC TAC TOE -->
<div class="screen"><div class="card">
<h1>Win this to win my heart ‚ùå‚≠ï</h1>
<div class="board" id="board"></div>
</div></div>

<!-- MEMORY -->
<div class="screen"><div class="card">
<h1>Find pairs just like we are üß©</h1>
<div class="mosaic" id="mosaic"></div>
</div></div>

<!-- LETTER -->
<!-- LETTER -->
<div class="screen">
  <div class="card">

    <h1 id="letterTitle">Your Love Letter üíå</h1>

    <div id="letterBox">
      <div class="envelope" id="env" onclick="openEnvelope()">
        <div class="flap"></div>
        <div class="letter">
          <div id="typeText"></div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- ANNIVERSARY QUESTION -->
<div class="screen">
  <div class="card">
    <h1>Favorite anniversary plan? üéâ</h1>
    <button onclick="next()">Outing üåÜ</button>
    <button onclick="next()">Romantic Dinner üç∑</button>
    <button onclick="next()">Netflix & Chill üì∫</button>
    <button onclick="next()">Need a Gift üéÅ</button>
  </div>
</div>


<!-- GREAT IDEA SCREEN -->
<div class="screen">
  <div class="card" onclick="next()">
    <h1>Sounds like a great idea, boss! üòéüíñ</h1>
    <p>Now I have one last question for you‚Ä¶</p>
    <small style="opacity:.6">tap to continue ‚ú®</small>
  </div>
</div>


<div class="screen">
  <div class="card">
    <h1>Will you be my Valentine? üíò</h1>
    <div id="valBox">
      <button id="yesBtn" onclick="yes()">Yes üòç</button>
      <button id="noBtn">No üò¢</button>
    </div>
  </div>
</div>




<div class="screen">
  <div class="card">
    <div id="finalLove">
      One of your best decisions!! <br>I love you Kanda! ‚ù§Ô∏è
    </div>
  </div>
</div>


</div></div>

</div>

<script>

/* Background collage */
const bgImgs=["bg1.jpg","bg2.jpg","bg3.jpg","bg4.jpg","bg5.jpg"];
for(let i=0;i<90;i++){
let t=document.createElement("div");
t.className="bgTile";
t.style.backgroundImage=`url(${bgImgs[Math.floor(Math.random()*5)]})`;
t.style.left=Math.random()*100+"%";
t.style.top=Math.random()*100+"%";
bg.appendChild(t);
}

/* SPA */
let step=0;
const next = () => {
  step++;
  app.style.transform = `translateX(-${step * 100}vw)`;
  updateProgress();

  const total = document.querySelectorAll(".screen").length;

  // Valentine screen
  if(step === total - 2){
    activateNo();
  }

  // Final screen
  if(step === total - 1){
    stopNo();
  }
};





/* Questions */
check1=()=>["7259196694","6361434372"].includes(q1.value)&&next();
check2=()=>q2.value.toLowerCase()=="pizza bakery"&&next();
check3=()=>q3.value.toLowerCase()=="black coffee"&&next();

/* MAP + PLANE (UNCHANGED) */
const map=L.map('map',{zoomControl:false});
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

const route=[
[12.97,77.59,"map_bengaluru.jpg"],
[15.85,74.49,"map_belagavi.jpg"],
[48.85,2.35,"map_paris.jpg"],
[46.81,8.22,"map_switzerland.jpg"],
[7.87,80.77,"map_srilanka.jpg"]
];

route.forEach(p=>{
const m=L.marker([p[0],p[1]]).addTo(map);
m.on("click",e=>{
e.originalEvent.stopPropagation();
openPhoto(p[2]);
});
});

const path=[];
for(let i=0;i<route.length-1;i++){
for(let t=0;t<=1;t+=.02){
path.push([
(1-t)*route[i][0]+t*route[i+1][0],
(1-t)*route[i][1]+t*route[i+1][1]
]);
}
}

L.polyline(path,{color:"#ff6fa5",weight:4}).addTo(map);
map.fitBounds(path);

const plane=L.marker(path[0],{icon:L.divIcon({className:'plane',html:'‚úàÔ∏è'})}).addTo(map);

let pi=0;
setInterval(()=>{
pi=(pi+1)%path.length;
plane.setLatLng(path[pi]);
},80);

map.on("click",()=>next());

function openPhoto(src){
modalImg.src=src;
photoModal.style.display="flex";
}
function closePhoto(){photoModal.style.display="none"}

/* Tic tac toe */
let cells=Array(9).fill("");
function draw(){
board.innerHTML="";
cells.forEach((v,i)=>{
let c=document.createElement("div");
c.className="cell";c.textContent=v;c.onclick=()=>play(i);
board.appendChild(c);
});
}
draw();

const wins=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
const win=p=>wins.some(w=>cells[w[0]]===p&&cells[w[1]]===p&&cells[w[2]]===p);

function play(i){
if(cells[i])return;
cells[i]="X";
if(win("X")){setTimeout(next,600);return;}
let e=cells.map((v,i)=>v?null:i).filter(v=>v!==null);
if(!e.length){cells=Array(9).fill("");draw();return;}
cells[e[Math.floor(Math.random()*e.length)]]="O";
if(win("O"))cells=Array(9).fill("");
draw();
}

/* Memory game unchanged */
const photos=["photo1.jpg","photo2.jpg","photo3.jpg","photo4.jpg","photo5.jpg","photo6.jpg","photo7.jpg","photo8.jpg"];
let cards=[...photos,...photos].sort(()=>Math.random()-0.5);
let first=null,lock=false,matched=0;

cards.forEach(src=>{
let t=document.createElement("div");t.className="tile";
let im=document.createElement("img");im.src=src;t.appendChild(im);
t.onclick=()=>{
if(lock||t.classList.contains("revealed"))return;
t.classList.add("revealed");
if(!first){first=t;return;}
lock=true;
setTimeout(()=>{
if(first.querySelector("img").src===im.src){
matched+=2;if(matched===cards.length)next();
}else{
first.classList.remove("revealed");t.classList.remove("revealed");
}
first=null;lock=false;
},600);
};
mosaic.appendChild(t);
});

/* ‚úçÔ∏è TYPEWRITER + AUTO SCROLL ONLY PATCH */
const letterText=`Hey love ‚ù§Ô∏è

Before you came into my life, I was normal‚Ä¶
Now I‚Äôm happy, crazy, smiling all the time, and totally in love üòú

You‚Äôve stolen my heart, my sleep, my food sometimes üçüüòÇ
but I still choose you every single day üíï

Thank you for loving me even when I‚Äôm annoying (which is often üòÜ).
Life with you is my favorite adventure ‚ù§Ô∏è

You‚Äôre my favorite person, my safe place,
and my forever Valentine üíñ

I love you more than rotti‚Ä¶ and that‚Äôs saying A LOT üçïüòÇ`;

let ti=0;

function typeLetter(){
  if(ti < letterText.length){
    typeText.innerHTML += letterText[ti] === "\n" ? "<br>" : letterText[ti];
    ti++;

    const box = document.querySelector(".letter");
    box.scrollTop = box.scrollHeight;

    setTimeout(typeLetter, 110);   // slower readable
  } 
  else {
    // typing DONE ‚Äì now unlock next step
setTimeout(()=>{
  next();   // go to anniversary as next screen
},1200);

  }
}



function openEnvelope(){
  env.classList.add("open");
  letterTitle.classList.add("fadeOut");

  // shrink card to hug letter
  env.closest(".card").classList.add("compact");

  typeLetter();
}



function goVal(){
next();
}

const sad=["üò¢","üò≠","ü•∫","üíî","üòû","üòî"];
let noTimer=null;

function jumpNo(){
  const btnWidth = noBtn.offsetWidth;
  const btnHeight = noBtn.offsetHeight;

  const padding = 20;

  const maxX = window.innerWidth - btnWidth - padding;
  const maxY = window.innerHeight - btnHeight - padding;

  const x = Math.random() * maxX + padding;
  const y = Math.random() * maxY + padding;

  noBtn.style.left = x + "px";
  noBtn.style.top  = y + "px";

  noBtn.textContent = "No " + sad[Math.floor(Math.random()*sad.length)];
}


function activateNo(){
  jumpNo();

  if(noTimer) clearInterval(noTimer);
  noTimer = setInterval(jumpNo, 850);

  document.addEventListener("mousemove", magneticMove);
}

function magneticMove(e){
  const r = noBtn.getBoundingClientRect();
  const dx = e.clientX - (r.left + r.width/2);
  const dy = e.clientY - (r.top + r.height/2);
  if(Math.hypot(dx,dy) < 150) jumpNo();
}




function yes(){
  next();

  const heart = document.getElementById("heartSound");
  const cheer = document.getElementById("hurraySound");

  heart.volume = 0.8;
  cheer.volume = 0.9;

  heart.currentTime = 0;
  cheer.currentTime = 0;

  heart.play();
  setTimeout(()=> cheer.play(), 600);   // cheer after heartbeat

  setTimeout(()=>{
    finalLove.style.display="block";
    fireworks();
    setInterval(spawnHeart,600);
  },400);
}





/* ===== REAL FIREWORKS ANIMATION ===== */

const canvas = document.getElementById("fx");
const ctx = canvas.getContext("2d");

function resizeCanvas(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
resizeCanvas();
addEventListener("resize", resizeCanvas);

let particles = [];

function createFirework(x, y){
  for(let i=0;i<160;i++){
    particles.push({
      x,y,
      vx:(Math.random()-0.5)*8,
      vy:(Math.random()-0.5)*8,
      life:80,
      color:`hsl(${Math.random()*360},100%,70%)`
    });
  }
}

function updateFireworks(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  particles.forEach(p=>{
    ctx.fillStyle=p.color;
    ctx.fillRect(p.x,p.y,4,4);
    p.x+=p.vx;
    p.y+=p.vy;
    p.vy+=0.05;   // gravity
    p.life--;
  });

  particles = particles.filter(p=>p.life>0);
  requestAnimationFrame(updateFireworks);
}

function fireworks(){
  setInterval(()=>{
    createFirework(
      Math.random()*canvas.width,
      Math.random()*canvas.height*0.6
    );
  },500);

  updateFireworks();
}

const screens = document.querySelectorAll(".screen");
const progressBar = document.getElementById("progressBar");

screens.forEach(()=> {
  const h=document.createElement("div");
  h.className="heartStep";
  h.textContent="‚ù§Ô∏è";
  progressBar.appendChild(h);
});

function updateProgress(){
  document.querySelectorAll(".heartStep").forEach((h,i)=>{
    h.classList.toggle("active", i <= step);
  });
}

updateProgress();

function stopNo(){
  if(noTimer) clearInterval(noTimer);
}

function spawnSoftHeart(){
const h = document.createElement("div");
h.className = "floatingHeart";

const hearts = ["‚ù§Ô∏è","üíñ","üíï","üíò","üíó"];
h.textContent = hearts[Math.floor(Math.random()*hearts.length)];

h.style.left = Math.random()*100 + "vw";
h.style.fontSize = 14 + Math.random()*26 + "px";

const duration = 6 + Math.random()*6;
h.style.animationDuration = duration + "s";

document.body.appendChild(h);

setTimeout(()=>h.remove(), duration*1000);
}

/* continuous soft flow */
setInterval(spawnSoftHeart, 420);

h.style.setProperty("--drift", Math.random());

let musicStarted = false;

function forceStartMusic(){
  if(musicStarted) return;

  const music = document.getElementById("bgMusic");
  music.volume = 0.5;

  music.play().then(()=>{
    musicStarted = true;
  }).catch(()=>{});
}

/* trigger on ANY real interaction */
["click","touchstart","keydown"].forEach(evt=>{
  document.addEventListener(evt, forceStartMusic, { once:true });
});

function startMusicSafe(){
  const m = document.getElementById("bgMusic");
  if(!m.paused) return;
  m.volume = 0.5;
  m.play().catch(()=>{});
}



</script>

</body>
</html>
